(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5728:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return i(5376)}])},5376:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return Z}});var o=i(5893),r=i(2818);let s="https://simple-push-production.up.railway.app/api";async function a(e){var t,i,o;console.log(s);let r=await (null==navigator?void 0:null===(t=navigator.serviceWorker)||void 0===t?void 0:t.getRegistration()),a=await (null==r?void 0:null===(i=r.pushManager)||void 0===i?void 0:i.getSubscription());if(a)return;let n=await (null==r?void 0:null===(o=r.pushManager)||void 0===o?void 0:o.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){let t="=".repeat((4-e.length%4)%4),i=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),o=window.atob(i),r=new Uint8Array(o.length);for(let e=0;e<o.length;++e)r[e]=o.charCodeAt(e);return r}("BNi8qKCi_vabffu_Byt76vs-ps6qmUN2iuN6yfWpvPCDfM4uTJisWzUvPfXmmxrFBNwC6zpOXKp0X82wmG08300")}));await fetch("".concat(s,"/users/add-subscription"),{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(e)},body:JSON.stringify(n)})}async function n(){try{if("default"===Notification.permission)throw Error("denied");"serviceWorker"in navigator&&"PushManager"in window&&navigator.serviceWorker.register("/sw.js")}catch(e){return e.message}}let l="https://simple-push-production.up.railway.app/api/todos",c=async e=>{let{token:t}=e;try{let e=await fetch(l,{headers:{authorization:"Bearer ".concat(t)}}),i=await e.json();return i}catch(e){throw Error(e.message)}},d=async e=>{let{request:t,token:i}=e;try{let e=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(i)},body:JSON.stringify(t)}),o=await e.json();if(200===e.status)return o;throw Error("Failed please try again later.")}catch(e){throw Error(e.message)}},h=async e=>{let{request:t,token:i}=e;try{let e=await fetch("".concat(l,"/").concat(t._id),{method:"PATCH",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(i)},body:JSON.stringify(t)}),o=await e.json();if(200===e.status)return o;throw Error("Failed please try again later.")}catch(e){throw Error(e.message)}},u=async e=>{let{request:t,token:i}=e;try{let e=await fetch("".concat(l,"/").concat(t._id),{method:"DELETE",headers:{authorization:"Bearer ".concat(i)}}),o=await e.json();if(200===e.status)return o;throw Error("Failed please try again later.")}catch(e){throw Error(e.message)}};var p=i(2445),m=i(3575),x=i(3991),g=i(7294),f=i(6817),j=i(1017),y=i(6991),v=i(7148),w=i(9834),b=i(5117);let k=(0,f.k)(()=>({navbar:{height:60,borderBottom:"1px solid #444",display:"flex",alignItems:"center",justifyContent:"center"}})),_=()=>{let{classes:e}=k(),{notifications:t,setNotifications:i}=(0,r.V)();return navigator.serviceWorker.addEventListener("message",e=>{i([e.data,...t])}),(0,o.jsx)(j.Z,{className:e.navbar,radius:0,children:(0,o.jsxs)(y.v,{withinPortal:!0,children:[(0,o.jsx)(y.v.Target,{children:(0,o.jsx)(v.z,{label:t.length,color:"red",size:16,children:(0,o.jsx)(w.A,{children:(0,o.jsx)(x.YK1,{})})})}),(0,o.jsx)(y.v.Dropdown,{children:t.map((e,t)=>(0,o.jsxs)(y.v.Item,{sx:{width:250},children:[(0,o.jsx)(b.x,{fz:"md",weight:"bold",children:e.title}),(0,o.jsx)(b.x,{color:"dimmed",fz:"sm",children:e.body})]},t))})]})})};var C=i(9236);let z=()=>(0,o.jsx)(C.D,{mt:80,order:2,align:"center",color:"gray",children:"No todos yet..."});var N=i(8623);let E=()=>(0,o.jsxs)(j.Z,{withBorder:!0,children:[(0,o.jsx)(N.O,{height:20,width:"20%",mb:"md"}),(0,o.jsx)(N.O,{height:20,width:"80%"})]});var S=i(7414),T=i(61),B=i(7841),O=i(8610),P=i(8903),A=i(5762);let I=()=>{let[e,t]=(0,g.useState)(!1),{user:i,todos:s,setTodos:a}=(0,r.V)(),n=(0,P.c)({initialValues:{title:"",body:"",schedule:""},validate:{title:(0,A.U)("Title Required!"),body:(0,A.U)("Body Required!"),schedule:(0,A.U)("Schedule Required!")}}),l=async e=>{let r={title:e.title,body:e.body,schedule:e.schedule};t(!0),d({request:r,token:i.token}).then(e=>{a([e,...s]),t(!1),n.reset()}).catch(e=>{t(!1),(0,m.c0)({id:"add-todo",color:"red",title:"Failed!",message:"".concat(e.message),icon:(0,o.jsx)(x.Us8,{size:16}),autoClose:3e3})})};return(0,o.jsx)(S.x,{mb:"lg",children:(0,o.jsxs)("form",{onSubmit:n.onSubmit(e=>l(e)),children:[(0,o.jsx)(T.o,{mb:"sm",disabled:e,autoComplete:"off",variant:"filled",icon:(0,o.jsx)(x.TRY,{stroke:1.4,size:20}),withAsterisk:!0,label:"Title",placeholder:"your title",...n.getInputProps("title")}),(0,o.jsx)(T.o,{mb:"sm",disabled:e,autoComplete:"off",variant:"filled",icon:(0,o.jsx)(x.fu1,{stroke:1.4,size:20}),withAsterisk:!0,label:"Content",placeholder:"your content",...n.getInputProps("body")}),(0,o.jsx)(O.x,{mb:"md",disabled:e,placeholder:"your schedule",autoComplete:"off",variant:"filled",icon:(0,o.jsx)(x.joI,{stroke:1.4,size:20}),withAsterisk:!0,label:"Schedule",...n.getInputProps("schedule")}),(0,o.jsx)(B.z,{type:"submit",variant:"light",loading:e,leftIcon:(0,o.jsx)(x.SC9,{stroke:1.4,size:20}),fullWidth:!0,children:"ADD"})]})})};var U=i(8036),F=i(9737),D=i(381),W=i.n(D);let M=(0,f.k)(()=>({action1:{position:"absolute",top:10,right:10},action2:{position:"absolute",top:10,right:50}})),R=e=>{let{todo:t}=e,{classes:i}=M(),{user:s,todos:a,setTodos:n}=(0,r.V)(),[l,c]=(0,g.useState)(!1),d=()=>{let e={_id:t._id};c(!0),u({request:e,token:s.token}).then(e=>{let t=a.filter(t=>t._id!==e._id);c(!1),n(t)}).catch(e=>{c(!1),(0,m.c0)({id:"delete-todo",color:"red",title:"Failed!",message:"".concat(e.message),icon:(0,o.jsx)(x.Us8,{size:16}),autoClose:3e3})})},p=()=>{let e={_id:t._id,completed:!t.completed};c(!0),h({request:e,token:s.token}).then(e=>{let t=a.map(t=>(t._id===e._id&&(t.completed=e.completed),t));c(!1),n(t)}).catch(e=>{c(!1),(0,m.c0)({id:"update-todo",color:"red",title:"Failed!",message:"".concat(e.message),icon:(0,o.jsx)(x.Us8,{size:16}),autoClose:3e3})})};return(0,o.jsx)(U.u,{mounted:!0,transition:"fade",duration:400,timingFunction:"ease",children:e=>(0,o.jsx)("div",{style:e,children:(0,o.jsxs)(j.Z,{withBorder:!0,mb:"xs",pos:"relative",children:[(0,o.jsx)(F.f,{visible:l,overlayBlur:2}),(0,o.jsx)(w.A,{className:i.action1,onClick:d,children:(0,o.jsx)(x.IT9,{color:"red",stroke:1})}),(0,o.jsx)(w.A,{className:i.action2,onClick:p,children:t.completed?(0,o.jsx)(x.rdd,{color:"green",stroke:1.4}):(0,o.jsx)(x.NOm,{color:"green",stroke:1.4})}),(0,o.jsx)(C.D,{children:t.title}),(0,o.jsx)(b.x,{size:"sm",italic:!0,color:"dimmed",children:W()(t.schedule).format("D MMM h:mm A")}),(0,o.jsx)(b.x,{children:t.body})]})})})},V=e=>{let{todos:t}=e;return t.map(e=>(0,o.jsx)(R,{todo:e},e._id))},q=()=>{let{todos:e,setTodos:t,user:i}=(0,r.V)(),s=()=>{n().then(e=>{"denied"===e&&(0,m.c0)({id:"notification-handler",color:"red",title:"You are not subscribed",message:"Click me to allow notifications",icon:(0,o.jsx)(x.Us8,{size:16}),autoClose:!1,onClick:()=>a(i.token)})})};return(0,g.useEffect)(()=>{i&&(s(),c({token:i.token}).then(e=>{t(e)}))},[i]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(_,{}),(0,o.jsxs)(p.W,{size:"xs",pt:50,children:[(0,o.jsx)(I,{}),!e&&(0,o.jsx)(E,{}),e&&e.length>0&&(0,o.jsx)(V,{todos:e}),e&&0==e.length&&(0,o.jsx)(z,{})]})]})};var J=i(966),X=i(1163);let K=(0,f.k)(e=>({placeholder:{height:"100vh",display:"flex",justifyContent:"center",alignItems:"center"}})),Y=()=>{let{classes:e}=K(),t=(0,X.useRouter)(),[i,r]=(0,g.useState)(!1);return((0,g.useEffect)(()=>{let e=JSON.parse(localStorage.getItem("userInfo"));e?(r(!0),t.push("/")):(r(!1),t.push("/auth"))},[]),i)?(0,o.jsx)(q,{}):(0,o.jsx)(S.x,{className:e.placeholder,children:(0,o.jsx)(J.a,{color:"yellow"})})};var Z=Y}},function(e){e.O(0,[584,885,435,177,774,888,179],function(){return e(e.s=5728)}),_N_E=e.O()}]);