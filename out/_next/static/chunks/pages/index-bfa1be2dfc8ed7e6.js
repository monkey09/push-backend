(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5728:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return i(5376)}])},5376:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return Y}});var r=i(5893),o=i(2818);async function a(e){var t,i,r;let o=await (null==navigator?void 0:null===(t=navigator.serviceWorker)||void 0===t?void 0:t.getRegistration()),a=await (null==o?void 0:null===(i=o.pushManager)||void 0===i?void 0:i.getSubscription());if(a)return;let s=await (null==o?void 0:null===(r=o.pushManager)||void 0===r?void 0:r.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){let t="=".repeat((4-e.length%4)%4),i=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),r=window.atob(i),o=new Uint8Array(r.length);for(let e=0;e<r.length;++e)o[e]=r.charCodeAt(e);return o}("BNi8qKCi_vabffu_Byt76vs-ps6qmUN2iuN6yfWpvPCDfM4uTJisWzUvPfXmmxrFBNwC6zpOXKp0X82wmG08300")}));await fetch("".concat("https://simple-push-production.up.railway.app/api","/users/add-subscription"),{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(e)},body:JSON.stringify(s)})}async function s(){try{if("default"===Notification.permission)throw Error("denied");"serviceWorker"in navigator&&"PushManager"in window&&navigator.serviceWorker.register("/sw.js")}catch(e){return e.message}}let n="https://simple-push-production.up.railway.app/api/todos",l=async e=>{let{token:t}=e;try{let e=await fetch(n,{headers:{authorization:"Bearer ".concat(t)}}),i=await e.json();return i}catch(e){throw Error(e.message)}},c=async e=>{let{request:t,token:i}=e;try{let e=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(i)},body:JSON.stringify(t)}),r=await e.json();if(200===e.status)return r;throw Error("Failed please try again later.")}catch(e){throw Error(e.message)}},d=async e=>{let{request:t,token:i}=e;try{let e=await fetch("".concat(n,"/").concat(t._id),{method:"PATCH",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(i)},body:JSON.stringify(t)}),r=await e.json();if(200===e.status)return r;throw Error("Failed please try again later.")}catch(e){throw Error(e.message)}},h=async e=>{let{request:t,token:i}=e;try{let e=await fetch("".concat(n,"/").concat(t._id),{method:"DELETE",headers:{authorization:"Bearer ".concat(i)}}),r=await e.json();if(200===e.status)return r;throw Error("Failed please try again later.")}catch(e){throw Error(e.message)}};var u=i(2445),p=i(3575),m=i(3991),x=i(7294),f=i(6817),g=i(1017),j=i(6991),y=i(7148),v=i(9834),w=i(5117);let b=(0,f.k)(()=>({navbar:{height:60,borderBottom:"1px solid #444",display:"flex",alignItems:"center",justifyContent:"center"}})),k=()=>{let{classes:e}=b(),{notifications:t,setNotifications:i}=(0,o.V)();return navigator.serviceWorker.addEventListener("message",e=>{i([e.data,...t])}),(0,r.jsx)(g.Z,{className:e.navbar,radius:0,children:(0,r.jsxs)(j.v,{withinPortal:!0,children:[(0,r.jsx)(j.v.Target,{children:(0,r.jsx)(y.z,{label:t.length,color:"red",size:16,children:(0,r.jsx)(v.A,{children:(0,r.jsx)(m.YK1,{})})})}),(0,r.jsx)(j.v.Dropdown,{children:t.map((e,t)=>(0,r.jsxs)(j.v.Item,{sx:{width:250},children:[(0,r.jsx)(w.x,{fz:"md",weight:"bold",children:e.title}),(0,r.jsx)(w.x,{color:"dimmed",fz:"sm",children:e.body})]},t))})]})})};var _=i(9236);let C=()=>(0,r.jsx)(_.D,{mt:80,order:2,align:"center",color:"gray",children:"No todos yet..."});var z=i(8623);let N=()=>(0,r.jsxs)(g.Z,{withBorder:!0,children:[(0,r.jsx)(z.O,{height:20,width:"20%",mb:"md"}),(0,r.jsx)(z.O,{height:20,width:"80%"})]});var E=i(7414),S=i(61),T=i(7841),B=i(8610),O=i(8903),P=i(5762);let A=()=>{let[e,t]=(0,x.useState)(!1),{user:i,todos:a,setTodos:s}=(0,o.V)(),n=(0,O.c)({initialValues:{title:"",body:"",schedule:""},validate:{title:(0,P.U)("Title Required!"),body:(0,P.U)("Body Required!"),schedule:(0,P.U)("Schedule Required!")}}),l=async e=>{let o={title:e.title,body:e.body,schedule:e.schedule};t(!0),c({request:o,token:i.token}).then(e=>{s([e,...a]),t(!1),n.reset()}).catch(e=>{t(!1),(0,p.c0)({id:"add-todo",color:"red",title:"Failed!",message:"".concat(e.message),icon:(0,r.jsx)(m.Us8,{size:16}),autoClose:3e3})})};return(0,r.jsx)(E.x,{mb:"lg",children:(0,r.jsxs)("form",{onSubmit:n.onSubmit(e=>l(e)),children:[(0,r.jsx)(S.o,{mb:"sm",disabled:e,autoComplete:"off",variant:"filled",icon:(0,r.jsx)(m.TRY,{stroke:1.4,size:20}),withAsterisk:!0,label:"Title",placeholder:"your title",...n.getInputProps("title")}),(0,r.jsx)(S.o,{mb:"sm",disabled:e,autoComplete:"off",variant:"filled",icon:(0,r.jsx)(m.fu1,{stroke:1.4,size:20}),withAsterisk:!0,label:"Content",placeholder:"your content",...n.getInputProps("body")}),(0,r.jsx)(B.x,{mb:"md",disabled:e,placeholder:"your schedule",autoComplete:"off",variant:"filled",icon:(0,r.jsx)(m.joI,{stroke:1.4,size:20}),withAsterisk:!0,label:"Schedule",...n.getInputProps("schedule")}),(0,r.jsx)(T.z,{type:"submit",variant:"light",loading:e,leftIcon:(0,r.jsx)(m.SC9,{stroke:1.4,size:20}),fullWidth:!0,children:"ADD"})]})})};var I=i(8036),U=i(9737),F=i(381),D=i.n(F);let W=(0,f.k)(()=>({action1:{position:"absolute",top:10,right:10},action2:{position:"absolute",top:10,right:50}})),M=e=>{let{todo:t}=e,{classes:i}=W(),{user:a,todos:s,setTodos:n}=(0,o.V)(),[l,c]=(0,x.useState)(!1),u=()=>{let e={_id:t._id};c(!0),h({request:e,token:a.token}).then(e=>{let t=s.filter(t=>t._id!==e._id);c(!1),n(t)}).catch(e=>{c(!1),(0,p.c0)({id:"delete-todo",color:"red",title:"Failed!",message:"".concat(e.message),icon:(0,r.jsx)(m.Us8,{size:16}),autoClose:3e3})})},f=()=>{let e={_id:t._id,completed:!t.completed};c(!0),d({request:e,token:a.token}).then(e=>{let t=s.map(t=>(t._id===e._id&&(t.completed=e.completed),t));c(!1),n(t)}).catch(e=>{c(!1),(0,p.c0)({id:"update-todo",color:"red",title:"Failed!",message:"".concat(e.message),icon:(0,r.jsx)(m.Us8,{size:16}),autoClose:3e3})})};return(0,r.jsx)(I.u,{mounted:!0,transition:"fade",duration:400,timingFunction:"ease",children:e=>(0,r.jsx)("div",{style:e,children:(0,r.jsxs)(g.Z,{withBorder:!0,mb:"xs",pos:"relative",children:[(0,r.jsx)(U.f,{visible:l,overlayBlur:2}),(0,r.jsx)(v.A,{className:i.action1,onClick:u,children:(0,r.jsx)(m.IT9,{color:"red",stroke:1})}),(0,r.jsx)(v.A,{className:i.action2,onClick:f,children:t.completed?(0,r.jsx)(m.rdd,{color:"green",stroke:1.4}):(0,r.jsx)(m.NOm,{color:"green",stroke:1.4})}),(0,r.jsx)(_.D,{children:t.title}),(0,r.jsx)(w.x,{size:"sm",italic:!0,color:"dimmed",children:D()(t.schedule).format("D MMM h:mm A")}),(0,r.jsx)(w.x,{children:t.body})]})})})},R=e=>{let{todos:t}=e;return t.map(e=>(0,r.jsx)(M,{todo:e},e._id))},V=()=>{let{todos:e,setTodos:t,user:i}=(0,o.V)(),n=()=>{s().then(e=>{"denied"===e&&(0,p.c0)({id:"notification-handler",color:"red",title:"You are not subscribed",message:"Click me to allow notifications",icon:(0,r.jsx)(m.Us8,{size:16}),autoClose:!1,onClick:()=>a(i.token)})})};return(0,x.useEffect)(()=>{i&&(n(),l({token:i.token}).then(e=>{t(e)}))},[i]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k,{}),(0,r.jsxs)(u.W,{size:"xs",pt:50,children:[(0,r.jsx)(A,{}),!e&&(0,r.jsx)(N,{}),e&&e.length>0&&(0,r.jsx)(R,{todos:e}),e&&0==e.length&&(0,r.jsx)(C,{})]})]})};var q=i(966),J=i(1163);let X=(0,f.k)(e=>({placeholder:{height:"100vh",display:"flex",justifyContent:"center",alignItems:"center"}})),K=()=>{let{classes:e}=X(),t=(0,J.useRouter)(),[i,o]=(0,x.useState)(!1);return((0,x.useEffect)(()=>{let e=JSON.parse(localStorage.getItem("userInfo"));e?(o(!0),t.push("/")):(o(!1),t.push("/auth"))},[]),i)?(0,r.jsx)(V,{}):(0,r.jsx)(E.x,{className:e.placeholder,children:(0,r.jsx)(q.a,{color:"yellow"})})};var Y=K}},function(e){e.O(0,[584,885,435,177,774,888,179],function(){return e(e.s=5728)}),_N_E=e.O()}]);